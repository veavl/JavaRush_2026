# Настройка JAVA_HOME и решение проблем с PATH

## Тема обсуждения
Установка Java 21 LTS, настройка переменных окружения JAVA_HOME и PATH, решение проблемы с неправильной версией Java в командной строке.

### 1. Распаковка MSI файла вместо установки

**Скачанный файл:** `OpenJDK21U-jdk_x64_windows_hotspot_21.0.9_10.msi`

**Проблема:** MSI файл нельзя просто открыть как архив - он содержит базу данных установки с зашифрованными именами файлов.

**Преимущества распаковки вместо установки:**
- Не требует прав администратора
- Можно иметь несколько версий JDK одновременно
- Легче управлять версиями
- Не засоряет системные папки

**Способы распаковки MSI:**

#### Вариант 1: Через командную строку (CMD)
```cmd
msiexec /a "путь\к\OpenJDK21U-jdk_x64_windows_hotspot_21.0.9_10.msi" /qb TARGETDIR="C:\jdk-21.0.9_10"
```

**Параметры:**
- `/a` - административная установка (распаковка)
- `/qb` - тихий режим (без диалогов)
- `TARGETDIR` - папка назначения

**Важно:** Запустите CMD от имени администратора.

#### Вариант 2: Использовать ZIP версию (рекомендуется)
- Скачайте ZIP версию с сайта Adoptium
- Распакуйте обычным архиватором в `C:\jdk-21.0.9_10\`
- Проще и быстрее

#### Вариант 3: Использовать утилиту LessMSI
- Скачайте: https://lessmsi.activescott.com/
- Откройте MSI в LessMSI
- Извлеките все файлы в целевую папку

**Структура после распаковки:**
```
C:\jdk-21.0.9_10\
├── bin\
├── lib\
├── include\
├── conf\
└── ...
```

### 2. Настройка переменной JAVA_HOME

**Что такое JAVA_HOME:**
- Системная переменная окружения
- Указывает, какая версия Java используется по умолчанию
- Используется многими инструментами и приложениями

**Как установить JAVA_HOME:**

#### Способ 1: Через графический интерфейс
1. Нажмите `Win + Pause` (или ПКМ на "Этот компьютер" → "Свойства")
2. "Дополнительные параметры системы"
3. "Переменные среды"
4. В "Системные переменные" найдите `JAVA_HOME` (или создайте новую)
5. Установите значение: `C:\jdk-21.0.9_10`
6. Нажмите "ОК"

#### Способ 2: Через командную строку (от администратора)
```cmd
setx JAVA_HOME "C:\jdk-21.0.9_10" /M
```

**Проверка:**
```cmd
echo %JAVA_HOME%
```
Должно показать: `C:\jdk-21.0.9_10`

### 3. Настройка переменной PATH

**Важно:** В переменной `Path` должна быть запись `%JAVA_HOME%\bin`

**Как проверить и настроить:**

1. Откройте "Переменные среды"
2. В "Системные переменные" найдите `Path`
3. Нажмите "Изменить..."
4. Проверьте наличие `%JAVA_HOME%\bin`
5. Если нет - добавьте через "Создать"
6. Если есть - убедитесь, что он находится в начале списка

**Почему порядок важен:**
Windows ищет программы по порядку в PATH слева направо. Если `%JAVA_HOME%\bin` находится после других путей, где есть `java.exe`, будет использоваться та версия Java.

### 4. Переключение между версиями Java

#### 4.1. Как переключаться между версиями Java

**Принцип работы:**
- На диске могут лежать несколько версий JDK: `C:\jdk-17.0.12\`, `C:\jdk-21.0.9_10\`, `C:\jdk-22.0.2\` и т.д.
- Переменная `JAVA_HOME` указывает только на **одну активную версию** в данный момент
- В `PATH` используется `%JAVA_HOME%\bin`, который автоматически ссылается на активную версию
- Другие версии просто лежат на диске и **не используются**, пока `JAVA_HOME` не укажет на них

**Как переключиться на другую версию:**

#### Способ 1: Через графический интерфейс
1. Откройте "Переменные среды" (`Win + Pause` → "Дополнительные параметры системы" → "Переменные среды")
2. В "Системные переменные" найдите `JAVA_HOME`
3. Нажмите "Изменить..."
4. Измените значение на путь к нужной версии:
   - Для Java 17: `C:\jdk-17.0.12`
   - Для Java 21: `C:\jdk-21.0.9_10`
   - Для Java 22: `C:\jdk-22.0.2`
5. Нажмите "ОК" во всех окнах
6. **Важно:** Закройте все окна командной строки и откройте новую

#### Способ 2: Через командную строку (от администратора)
```cmd
setx JAVA_HOME "C:\jdk-17.0.12" /M
```
Или для другой версии:
```cmd
setx JAVA_HOME "C:\jdk-21.0.9_10" /M
```

**Важно:** После изменения `JAVA_HOME` обязательно:
1. Закройте все окна CMD/PowerShell
2. Откройте новую командную строку
3. Проверьте версию: `java -version`

**Пример структуры на диске:**
```
C:\
├── jdk-17.0.12\          ← лежит, но не используется (если JAVA_HOME указывает на другую версию)
├── jdk-21.0.9_10\        ← активная версия (если JAVA_HOME = C:\jdk-21.0.9_10)
└── jdk-22.0.2\           ← лежит, но не используется
```

**Проверка активной версии:**
```cmd
echo %JAVA_HOME%
java -version
where java
```

**Преимущества такого подхода:**
- Все версии доступны на диске
- Переключение занимает секунды (изменение одной переменной)
- Не нужно переустанавливать Java
- Можно быстро вернуться к предыдущей версии

#### 4.2. Как IDEA переключается между версиями Java

**Важно:** IntelliJ IDEA работает **независимо** от системной переменной `JAVA_HOME`. Каждый проект может использовать свою версию JDK.

**Как IDEA находит JDK:**
- Автоматически сканирует стандартные места установки: `C:\Program Files\Java\`, `C:\jdk-*` и т.д.
- Использует JDK, указанные в настройках проекта
- Может использовать системную `JAVA_HOME` как один из источников, но не зависит от неё

**Настройка JDK в IDEA:**

##### Способ 1: На уровне проекта
1. File → Project Structure (или `Ctrl + Alt + Shift + S`)
2. Вкладка "Project"
3. В поле "SDK" выберите нужную версию JDK из списка
4. Если нужной версии нет - нажмите "New..." и укажите путь к JDK (например, `C:\jdk-21.0.9_10`)
5. Нажмите "OK"

##### Способ 2: Добавление JDK в список доступных
1. File → Project Structure → SDKs
2. Нажмите "+" → "Add JDK..."
3. Укажите путь к папке JDK (например, `C:\jdk-17.0.12`)
4. IDEA автоматически определит версию и добавит в список
5. Теперь этот JDK будет доступен для выбора в любом проекте

##### Способ 3: На уровне модуля
1. File → Project Structure → Modules
2. Выберите нужный модуль
3. На вкладке "Dependencies" в поле "Module SDK" выберите версию JDK
4. Разные модули могут использовать разные версии JDK

**Преимущества подхода IDEA:**
- Каждый проект использует свою версию Java независимо от других
- Не нужно менять системную `JAVA_HOME` для работы с разными проектами
- Можно открыть несколько проектов одновременно, каждый со своей версией JDK
- Настройки JDK сохраняются в файле проекта (`.idea` или `*.iml`)

**Пример:**
- Проект A использует Java 17 (`C:\jdk-17.0.12`)
- Проект B использует Java 21 (`C:\jdk-21.0.9_10`)
- Системная `JAVA_HOME` может указывать на Java 22 (`C:\jdk-22.0.2`)
- Все три версии работают одновременно без конфликтов

### 5. Проблема: java -version показывает неправильную версию

**Симптомы:**
- `JAVA_HOME` установлена на Java 21: `C:\jdk-21.0.9_10`
- `java -version` показывает Java 22: `java version "22.0.2"`
- `where java` показывает: `C:\jdk-22.0.2\bin\java.exe`

**Причины:**
1. В `PATH` есть прямой путь к Java 22 (`C:\jdk-22.0.2\bin`), который идет раньше `%JAVA_HOME%\bin`
2. `%JAVA_HOME%\bin` находится не в начале списка PATH
3. Windows кэширует путь к `java.exe` из предыдущей конфигурации
4. Java 22 может быть установлена в системных папках Windows

**Решение:**

#### Шаг 1: Проверьте системный PATH
1. Откройте "Переменные среды"
2. В "Системные переменные" найдите `Path`
3. Нажмите "Изменить..."
4. Прокрутите весь список вниз
5. Ищите `C:\jdk-22.0.2\bin` или любые прямые пути к Java 22
6. Если найдете - удалите их

#### Шаг 2: Проверьте пользовательский PATH
1. В разделе "Переменные среды пользователя" найдите `Path`
2. Проверьте на наличие путей к Java 22
3. Удалите их, если найдете

#### Шаг 3: Переместите %JAVA_HOME%\bin в начало списка
1. В системном `Path` найдите `%JAVA_HOME%\bin`
2. Выделите его
3. Нажимайте кнопку "Вверх", пока он не окажется в самом верху списка
   (после системных путей Windows, но перед остальными)

#### Шаг 4: Перезапустите командную строку
- Закройте все окна CMD
- Откройте новую командную строку
- Выполните проверку:
  ```cmd
  where java
  java -version
  echo %JAVA_HOME%
  ```

**Ожидаемый результат:**
- `where java` → `C:\jdk-21.0.9_10\bin\java.exe`
- `java -version` → `openjdk version "21.0.9" ... LTS`
- `echo %JAVA_HOME%` → `C:\jdk-21.0.9_10`

### 6. Дополнительные проверки

**Если проблема не решается:**

#### Проверка системных папок Windows
```cmd
dir C:\Windows\System32\java.exe
dir C:\Windows\java.exe
```
Если файлы найдены - это может быть причиной.

#### Проверка всех путей к java.exe
```cmd
where /r C:\ java.exe
```
Покажет все места, где находится `java.exe`.

#### Проверка установленных программ
- Панель управления → Программы и компоненты
- Проверьте, не установлена ли Java 22 как системная программа

## Итоговые рекомендации

1. **Для установки:** Используйте ZIP версию JDK - проще распаковывать
2. **Расположение:** `C:\jdk-21.0.9_10\` (или аналогичная структура)
3. **JAVA_HOME:** Установите на путь к JDK: `C:\jdk-21.0.9_10`
4. **PATH:** Добавьте `%JAVA_HOME%\bin` и переместите в начало списка
5. **Проверка:** Всегда открывайте новую командную строку после изменения переменных окружения
6. **Порядок в PATH:** Критически важен - `%JAVA_HOME%\bin` должен быть в начале

## Команды для проверки

```cmd
# Проверка версии Java
java -version

# Проверка компилятора
javac -version

# Проверка переменной JAVA_HOME
echo %JAVA_HOME%

# Поиск исполняемого файла java
where java

# Проверка всех путей к java.exe
where /r C:\ java.exe
```


